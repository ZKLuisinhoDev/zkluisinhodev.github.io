---
const projects = [
  {
    id: "ceifoce",
    title: "CEIFOCE",
    description:
      "Sistema de gesti贸n integral para psicolog铆a (UDENAR), desarrollado con Django REST y React. Soporta aplicaci贸n masiva de encuestas y gesti贸n avanzada de roles. Incorpora una arquitectura escalable y autenticaci贸n segura mediante JWT, garantizando el manejo de datos sensibles y validaci贸n in-situ con c贸digos diarios. Desplegado en Railway.",
    tags: ["React", "Django REST", "JWT", "Scalable"],
    color: "from-blue-600 to-cyan-600",
    type: "carousel",
    images: [
      "/placeholders/ceifoce_1.jpeg",
      "/placeholders/ceifoce_2.jpeg",
      "/placeholders/ceifoce_3.jpeg",
    ],
  },
  {
    id: "kentur",
    title: "KENTUR",
    description:
      "Plataforma LMS educativa construida con React y Django REST Framework. Especializada en cursos y gesti贸n financiera de cr茅ditos educativos. Su arquitectura escalable y autenticaci贸n JWT garantizan un entorno seguro y de alto rendimiento para docentes, estudiantes y aliados, permitiendo un crecimiento sostenido.",
    tags: ["React", "Django REST", "JWT", "LMS"],
    color: "from-emerald-600 to-green-600",
    type: "carousel",
    images: [
      "/placeholders/kentur_1.jpg",
      "/placeholders/kentur_2.jpg",
      "/placeholders/kentur_3.jpg",
    ],
  },
  {
    id: "ecomindalapp",
    title: "ECOMINDALAPP",
    description:
      "Plataforma E-commerce y administrativa para el sector agroindustrial. Integra gesti贸n de inventarios y ventas con un backend robusto (Django REST), automatizaciones de negocio y un m贸dulo de inteligencia artificial como complemento para moderaci贸n. Enfoque 100% en la solidez del sistema y reglas de negocio.",
    tags: ["E-commerce", "Django REST", "Automatizaci贸n", "React"],
    color: "from-orange-600 to-amber-600",
    type: "carousel",
    images: [
      "/placeholders/eco_1.jpeg",
      "/placeholders/eco_2.jpeg",
      "/placeholders/eco_3.jpeg",
    ],
  },
  {
    id: "fastapi-task-manager",
    title: "API REST en FastAPI",
    description:
      "Backend de alto rendimiento para gesti贸n de tareas y usuarios. Implementa autenticaci贸n segura con JWT/OAuth2, validaci贸n estricta con Pydantic v2 y ORM SQLAlchemy. Dise帽ado con arquitectura modular y Dependency Injection, siguiendo las mejores pr谩cticas de Python moderno. Incluye documentaci贸n autom谩tica (Swagger/ReDoc) y tests con Pytest.",
    tags: ["FastAPI", "Python 3.10+", "JWT", "SQLAlchemy"],
    color: "from-teal-500 to-cyan-500",
    type: "link",
    link: "https://github.com/ZKLuisinhoDev/fastapi-task-manager-api",
  },
  {
    id: "password-strength",
    title: "Password Strength Checker ",
    description:
      "Evaluador de seguridad de contrase帽as en tiempo real con dise帽o Glassmorphism. El backend en FastAPI procesa la l贸gica de validaci贸n (longitud, entrop铆a, caracteres) devolviendo un feedback instant谩neo al frontend en Vanilla JS. Un ejemplo perfecto de micro-servicio enfocado en seguridad y UX.",
    tags: ["FastAPI", "Security", "Glassmorphism", "Python"],
    color: "from-indigo-500 to-violet-500",
    type: "link",
    link: "https://github.com/ZKLuisinhoDev/fastapi-glass-password-meter",
  },
  {
    id: "task-habit-tracker",
    title: "Task / Habit Tracker Full Stack ",
    description:
      "Sistema de gesti贸n de tareas Production-Ready dise帽ado con una arquitectura escalable. Combina un backend as铆ncrono de alto rendimiento en FastAPI con un frontend moderno en React (TypeScript + Vite). Implementa autenticaci贸n robusta (JWT + Argon2), gesti贸n de estado global y persistencia con SQLAlchemy. Un ejemplo completo de desarrollo web moderno.",
    tags: ["FastAPI", "React", "TypeScript", "TailwindCSS"],
    color: "from-pink-500 to-rose-500",
    type: "link",
    link: "https://github.com/ZKLuisinhoDev/task-habit-tracker-fullstack-fastapi-react",
  },
  {
    id: "games",
    title: "Proyectos de L贸gica (Pygame)",
    description:
      "Colecci贸n de algoritmos y simulaciones interactivas. Este proyecto demuestra dominio de fundamentos de computaci贸n, grafos y l贸gica compleja, aplicando principios de Clean Code y buenas pr谩cticas de ingenier铆a de software en Python puro.",
    tags: ["Clean Code", "Algoritmos", "L贸gica", "Python"],
    color: "from-purple-600 to-pink-600",
    type: "link",
    link: "https://github.com/ZKLuisinhoDev/mathinvaders_kodland",
  },
];
---

<section id="projects" class="py-32 px-4 relative">
  <div class="max-w-6xl mx-auto relative z-10">
    <div class="mb-16 text-center">
      <h2
        class="text-3xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-500"
      >
        Proyectos Destacados
      </h2>
      <p class="text-gray-400 max-w-xl mx-auto">
        Una selecci贸n de mis trabajos m谩s impactantes. Click en las tarjetas
        para ver m谩s detalles.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
      {
        projects.map((project) =>
          project.type === "link" ? (
            <a
              href={project.link}
              target="_blank"
              rel="noopener noreferrer"
              class="group relative rounded-2xl overflow-hidden bg-white/5 border border-white/10 hover:border-white/20 transition-all duration-300 hover:shadow-2xl hover:shadow-blue-500/10 hover:-translate-y-1 block h-full flex flex-col"
            >
              <div class="relative h-64 overflow-hidden bg-gray-900 shrink-0">
                <div
                  class={`absolute inset-0 bg-gradient-to-br ${project.color} opacity-80 group-hover:opacity-100 transition-all duration-500 flex items-center justify-center group-hover:scale-110`}
                >
                  <span class="text-6xl filter drop-shadow-lg">
                    {project.id === "games" ? "" : ""}
                  </span>
                </div>
                <div class="absolute inset-0 bg-blue-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 backdrop-blur-[2px]" />
              </div>
              <div class="p-8 relative flex flex-col grow">
                <h3 class="text-2xl font-bold mb-3 text-white group-hover:text-blue-400 transition-colors flex items-center justify-between">
                  {project.title}
                  <svg
                    class="w-5 h-5 text-gray-500 group-hover:text-blue-400 transform group-hover:translate-x-1 group-hover:-translate-y-1 transition-all shrink-0 ml-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                    />
                  </svg>
                </h3>
                <p class="text-gray-400 text-sm mb-6 leading-relaxed grow">
                  {project.description}
                </p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {project.tags.map((tag) => (
                    <span class="text-xs font-medium px-3 py-1 rounded-full bg-white/10 text-gray-300 border border-white/5 group-hover:border-blue-500/30 group-hover:bg-blue-500/10 transition-colors">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </a>
          ) : (
            <button
              class="project-card group relative rounded-2xl overflow-hidden bg-white/5 border border-white/10 hover:border-white/20 transition-all duration-300 hover:shadow-2xl hover:shadow-blue-500/10 hover:-translate-y-1 block w-full text-left flex flex-col h-full"
              data-project-json={JSON.stringify(project)}
            >
              <div class="relative h-64 overflow-hidden bg-gray-900 pointer-events-none shrink-0">
                <div class="absolute inset-0 bg-gradient-to-br from-gray-800 to-black flex items-center justify-center group-hover:scale-110 transition-transform duration-700 ease-in-out">
                  <div class="text-gray-600 text-sm font-mono border border-gray-700 p-4 rounded bg-black/50 backdrop-blur-sm text-center">
                    <span class="block mb-2 text-2xl"></span>
                    <span class="block text-xs uppercase tracking-wider">
                      Ver Galer铆a
                    </span>
                  </div>
                  <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] via-transparent to-transparent opacity-60" />
                </div>
                <div class="absolute inset-0 bg-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 backdrop-blur-[1px]" />
              </div>

              <div class="p-8 relative flex flex-col grow">
                <h3 class="text-2xl font-bold mb-3 text-white group-hover:text-blue-400 transition-colors flex items-center justify-between">
                  {project.title}
                  <svg
                    class="w-5 h-5 text-gray-500 group-hover:text-blue-400 shrink-0 ml-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <>
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                      />
                    </>
                  </svg>
                </h3>
                <p class="text-gray-400 text-sm mb-6 leading-relaxed line-clamp-4 group-hover:line-clamp-none transition-all duration-300 grow">
                  {project.description}
                </p>
                <div class="flex flex-wrap gap-2 mt-auto">
                  {project.tags.map((tag) => (
                    <span class="text-xs font-medium px-3 py-1 rounded-full bg-white/10 text-gray-300 border border-white/5 group-hover:border-blue-500/30 group-hover:bg-blue-500/10 transition-colors">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            </button>
          )
        )
      }
    </div>
  </div>

  <!-- Carousel Modal -->
  <div
    id="imageModal"
    class="fixed inset-0 z-50 hidden"
    aria-labelledby="modal-title"
    role="dialog"
    aria-modal="true"
  >
    <!-- Backdrop -->
    <div
      class="absolute inset-0 bg-black/90 backdrop-blur-sm transition-opacity opacity-0"
      id="modalBackdrop"
    >
    </div>

    <div class="absolute inset-0 z-10 overflow-y-auto">
      <div
        class="min-h-full flex items-center justify-center p-4 text-center sm:p-0"
      >
        <div
          class="relative bg-black rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:max-w-5xl sm:w-full border border-white/10 opacity-0 scale-95"
          id="modalPanel"
        >
          <!-- Close button -->
          <button
            type="button"
            class="absolute top-4 right-4 z-20 text-gray-400 hover:text-white bg-black/50 rounded-full p-2 transition-colors"
            id="closeModal"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>

          <!-- Image Container -->
          <div
            class="relative w-full aspect-video bg-gray-900 flex items-center justify-center group select-none"
          >
            <img
              id="modalImage"
              src=""
              alt="Project screenshot"
              class="max-h-full max-w-full object-contain transition-opacity duration-300"
            />

            <!-- Navigation Buttons -->
            <button
              id="prevBtn"
              class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-blue-600 text-white p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all transform hover:scale-110"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"></path></svg
              >
            </button>
            <button
              id="nextBtn"
              class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-blue-600 text-white p-3 rounded-full opacity-0 group-hover:opacity-100 transition-all transform hover:scale-110"
            >
              <svg
                class="w-6 h-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"></path></svg
              >
            </button>

            <!-- Counter -->
            <div
              class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 px-4 py-1 rounded-full text-sm text-gray-300 font-mono"
            >
              <span id="currentImageIdx">1</span> / <span id="totalImages"
                >3</span
              >
            </div>
          </div>

          <div class="p-6 bg-[#0a0a0a] border-t border-white/10">
            <h3 class="text-2xl font-bold text-white mb-2" id="modalTitle">
              Project Title
            </h3>
            <p class="text-gray-400" id="modalDesc">
              Project description goes here.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  interface Project {
    title: string;
    description: string;
    images: string[];
  }

  let currentImages: string[] = [];
  let currentIdx = 0;

  const modal = document.getElementById("imageModal");
  const modalBackdrop = document.getElementById("modalBackdrop");
  const modalPanel = document.getElementById("modalPanel");
  const modalImage = document.getElementById(
    "modalImage"
  ) as HTMLImageElement | null;
  const modalTitle = document.getElementById("modalTitle");
  const modalDesc = document.getElementById("modalDesc");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const currentImageIdx = document.getElementById("currentImageIdx");
  const totalImages = document.getElementById("totalImages");
  const closeModal = document.getElementById("closeModal");

  function openModal(project: Project) {
    currentImages = project.images;
    currentIdx = 0;

    // Update Content
    if (modalTitle) modalTitle.textContent = project.title;
    if (modalDesc) modalDesc.textContent = project.description;
    if (totalImages) totalImages.textContent = currentImages.length.toString();
    updateImage();

    // Show Modal
    if (modal) {
      modal.classList.remove("hidden");
      // Small delay for CSS transition
      setTimeout(() => {
        if (modalBackdrop) modalBackdrop.classList.remove("opacity-0");
        if (modalPanel) modalPanel.classList.remove("opacity-0", "scale-95");
      }, 10);
    }
  }

  function closeModalFunc() {
    if (modalBackdrop) modalBackdrop.classList.add("opacity-0");
    if (modalPanel) modalPanel.classList.add("opacity-0", "scale-95");
    setTimeout(() => {
      if (modal) modal.classList.add("hidden");
    }, 300);
  }

  function updateImage() {
    if (modalImage) {
      modalImage.style.opacity = "0";
      setTimeout(() => {
        if (modalImage) {
          modalImage.src =
            currentImages[currentIdx] ||
            "https://via.placeholder.com/800x450?text=No+Image+Loaded"; // Fallback
          if (currentImageIdx)
            currentImageIdx.textContent = (currentIdx + 1).toString();
          modalImage.style.opacity = "1";
        }
      }, 150);
    }
  }

  function nextImage() {
    if (currentImages.length === 0) return;
    currentIdx = (currentIdx + 1) % currentImages.length;
    updateImage();
  }

  function prevImage() {
    if (currentImages.length === 0) return;
    currentIdx = (currentIdx - 1 + currentImages.length) % currentImages.length;
    updateImage();
  }

  // Event Listeners
  document.querySelectorAll(".project-card").forEach((card) => {
    card.addEventListener("click", () => {
      const projectData = card.getAttribute("data-project-json");
      if (projectData) {
        const project = JSON.parse(projectData) as Project;
        openModal(project);
      }
    });
  });

  if (closeModal) closeModal.addEventListener("click", closeModalFunc);
  if (nextBtn) {
    nextBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      nextImage();
    });
  }
  if (prevBtn) {
    prevBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      prevImage();
    });
  }

  // Close on backdrop click
  if (modal) {
    modal.addEventListener("click", (e) => {
      const target = e.target as HTMLElement;
      if (target === modalBackdrop || target.closest("#modalPanel") === null) {
        if (target.closest(".project-card")) return;

        if (modalPanel) {
          const rect = modalPanel.getBoundingClientRect();
          const isInDialog =
            e.clientY >= rect.top &&
            e.clientY <= rect.bottom &&
            e.clientX >= rect.left &&
            e.clientX <= rect.right;
          if (!isInDialog) {
            closeModalFunc();
          }
        }
      }
    });
  }

  // Keyboard navigation
  document.addEventListener("keydown", (e) => {
    if (modal && modal.classList.contains("hidden")) return;
    if (e.key === "Escape") closeModalFunc();
    if (e.key === "ArrowRight") nextImage();
    if (e.key === "ArrowLeft") prevImage();
  });
</script>
